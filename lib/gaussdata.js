!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).GaussData=e()}(this,function(){"use strict";class t{reporter=null;startTime=Date.now();init(t){this.reporter=t,setTimeout(()=>{this.onPageLoad(),setTimeout(()=>{this.onPageView()})}),document.addEventListener("click",t=>{this.onClick(t)})}onClick(t){const e=t.target;this.reporter?.track("$element_click",{element_content:e.innerText,element_id:e.id,page_x:t.pageX,page_y:t.pageY})}onPageLoad(){this.reporter?.track("$page_load",{})}onPageView(){this.startTime=Date.now(),this.reporter?.track("$page_view",{})}onPageLeave(){this.reporter?.track("$page_leave",{duration:Date.now()-this.startTime})}}class e{static getCurrentUrl(){return window.location.href}static getPageTitle(){return document.title}static getUserAgent(){return navigator.userAgent}static getScreenResolution(){return{width:window.screen.width,height:window.screen.height}}static getViewportSize(){return{width:window.innerWidth||document.documentElement.clientWidth,height:window.innerHeight||document.documentElement.clientHeight}}static getDevicePixelRatio(){return window.devicePixelRatio||1}static getLanguage(){return navigator.language}static getReferrer(){return document.referrer}static collectAll(){const t=this.getScreenResolution(),e=this.getViewportSize();return{url:this.getCurrentUrl(),title:this.getPageTitle(),referrer:this.getReferrer(),dpr:this.getDevicePixelRatio(),user_agent:this.getUserAgent(),language:this.getLanguage(),screen_width:t.width,screen_height:t.height,window_width:e.width,window_height:e.height}}static toJSON(){return JSON.stringify(this.collectAll(),null,2)}}class i{static ANONYMOUS_ID_COOKIE="gd_anonymous_id";static SESSION_ID_COOKIE="gd_session_id";static ANONYMOUS_ID_EXPIRE_DAYS=730;static SESSION_ID_EXPIRE_MINUTES=30;static generateRandomId(t=32){const e="0123456789abcdef";let i="";if(window.crypto&&window.crypto.getRandomValues){const s=new Uint8Array(t);window.crypto.getRandomValues(s);for(let n=0;n<t;n++)i+=e[s[n]%16]}else for(let s=0;s<t;s++)i+=e[Math.floor(16*Math.random())];return i}static setCookie(t,e,i){let s="";if(void 0!==i){const t=new Date;t.setTime(t.getTime()+60*i*1e3),s=`expires=${t.toUTCString()};`}const n="https:"===window.location.protocol?"SameSite=None; Secure":"";document.cookie=`${t}=${e};${s}path=/;${n}`}static getCookie(t){const e=`${t}=`,i=document.cookie.split(";");for(let t=0;t<i.length;t++){let s=i[t];for(;" "===s.charAt(0);)s=s.substring(1);if(0===s.indexOf(e))return s.substring(e.length)}return null}static getAnonymousId(){let t=this.getCookie(this.ANONYMOUS_ID_COOKIE);return t||(t=this.generateRandomId(),this.setCookie(this.ANONYMOUS_ID_COOKIE,t,24*this.ANONYMOUS_ID_EXPIRE_DAYS*60)),t}static getSessionId(){let t=this.getCookie(this.SESSION_ID_COOKIE);return t||(t=this.generateRandomId(),this.setCookie(this.SESSION_ID_COOKIE,t,this.SESSION_ID_EXPIRE_MINUTES)),t}static resetSessionId(){const t=this.generateRandomId();return this.setCookie(this.SESSION_ID_COOKIE,t,this.SESSION_ID_EXPIRE_MINUTES),t}static clearAll(){this.setCookie(this.ANONYMOUS_ID_COOKIE,"",-1),this.setCookie(this.SESSION_ID_COOKIE,"",-1)}}class s{head={code:"",version:"0.0.1",time:Date.now(),aaid:i.getAnonymousId(),sid:i.getSessionId()};body={};constructor(t,i){this.head.code=t,this.body={...e.collectAll(),...i}}static toJson(t){return{head:{...t.head},body:{...t.body}}}}class n{maxLength=1e3;items;constructor(t){this.maxLength=t,this.items=[]}enqueue(t){this.items.length>this.maxLength&&this.dequeue(),this.items.push(t)}dequeue(){return this.items.shift()}peek(){return this.items[0]}isEmpty(){return 0===this.items.length}size(){return this.items.length}clear(){this.items=[]}toString(){return this.items.toString()}}class o{static instance;queue;maxQueueSize=1e3;timer=0;isConsuming=!1;url="/t";constructor(){this.queue=new n(this.maxQueueSize),this.timer=setInterval(()=>{this.consume()},1e3),(new t).init(this)}static getInstance(){return o.instance||(o.instance=new o),o.instance}static setUrl(t){this.getInstance().url=t}track(t,e){const i=new s(t,e);this.queue.enqueue(i)}consume(){if(!this.isConsuming&&!this.queue.isEmpty()){this.isConsuming=!0;try{const t=10,e=[];let i=[];for(;!this.queue.isEmpty();){const s=this.queue.dequeue();s&&(i.push(s),i.length===t&&(e.push(i),i=[]))}i.length>0&&e.push(i),this.processBatches(e)}finally{this.isConsuming=!1}}}processBatches(t){t.forEach((t,e)=>{console.log(`Processing batch ${e+1} with ${t.length} events`);const i=t.map(s.toJson);navigator.sendBeacon(this.url,JSON.stringify(i))})}destroy(){this.timer&&clearInterval(this.timer)}}return o});
