!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).GaussData=t()}(this,function(){"use strict";function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var t,n={exports:{}},i=n.exports;var o=(t||(t=1,function(e){var t,n;t=i,n=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],o={},r=null;function s(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(){for(var n=this.getLevel(),o=0;o<i.length;o++){var r=i[o];this[r]=o<n?e:this.methodFactory(r,n,this.name)}if(this.log=this.debug,typeof console===t&&n<this.levels.SILENT)return"No console available for logging"}function c(e){return function(){typeof console!==t&&(l.call(this),this[e].apply(this,arguments))}}function u(i,o,r){return function(i){return"debug"===i&&(i="log"),typeof console!==t&&("trace"===i&&n?a:void 0!==console[i]?s(console,i):void 0!==console.log?s(console,"log"):e)}(i)||c.apply(this,arguments)}function d(e,n){var s,a,c,d=this,h="loglevel";function g(){var e;if(typeof window!==t&&h){try{e=window.localStorage[h]}catch(e){}if(typeof e===t)try{var n=window.document.cookie,i=encodeURIComponent(h),o=n.indexOf(i+"=");-1!==o&&(e=/^([^;]+)/.exec(n.slice(o+i.length+1))[1])}catch(e){}return void 0===d.levels[e]&&(e=void 0),e}}function p(e){var t=e;if("string"==typeof t&&void 0!==d.levels[t.toUpperCase()]&&(t=d.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=d.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof e?h+=":"+e:"symbol"==typeof e&&(h=void 0),d.name=e,d.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},d.methodFactory=n||u,d.getLevel=function(){return null!=c?c:null!=a?a:s},d.setLevel=function(e,n){return c=p(e),!1!==n&&function(e){var n=(i[e]||"silent").toUpperCase();if(typeof window!==t&&h){try{return void(window.localStorage[h]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"="+n+";"}catch(e){}}}(c),l.call(d)},d.setDefaultLevel=function(e){a=p(e),g()||d.setLevel(e,!1)},d.resetLevel=function(){c=null,function(){if(typeof window!==t&&h){try{window.localStorage.removeItem(h)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}(),l.call(d)},d.enableAll=function(e){d.setLevel(d.levels.TRACE,e)},d.disableAll=function(e){d.setLevel(d.levels.SILENT,e)},d.rebuild=function(){if(r!==d&&(s=p(r.getLevel())),l.call(d),r===d)for(var e in o)o[e].rebuild()},s=p(r?r.getLevel():"WARN");var f=g();null!=f&&(c=p(f)),l.call(d)}(r=new d).getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=o[e];return t||(t=o[e]=new d(e,r.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return r.noConflict=function(){return typeof window!==t&&window.log===r&&(window.log=h),r},r.getLoggers=function(){return o},r.default=r,r},e.exports?e.exports=n():t.log=n()}(n)),n.exports),r=e(o);function s(e){const t=history[e];history[e]=function(...n){r.info(`History.${e} called with:`,n);const i=t.apply(this,n),o=new Event(e);return window.dispatchEvent(o),i}}s("pushState"),s("replaceState");class a{constructor(){Object.defineProperty(this,"reporter",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"startTime",{enumerable:!0,configurable:!0,writable:!0,value:Date.now()})}init(e){this.reporter=e,setTimeout(()=>{this.onPageLoad(),setTimeout(()=>{this.onPageView()})}),window.addEventListener("pushState",()=>this.onPageChange()),window.addEventListener("replaceState",()=>this.onPageChange()),window.addEventListener("popstate",()=>this.onPageChange()),document.addEventListener("click",e=>this.onClick(e))}onClick(e){var t,n;const i=e.target;null===(t=this.reporter)||void 0===t||t.track("$element_click",{element_id:i.id,element_class:i.className,element_content:(null===(n=i.textContent)||void 0===n?void 0:n.trim())||"",page_x:e.pageX,page_y:e.pageY})}onPageLoad(){var e;null===(e=this.reporter)||void 0===e||e.track("$page_load",{})}onPageChange(){this.onPageLeave(),setTimeout(()=>{this.onPageView()},16)}onPageView(){var e;this.startTime=Date.now(),null===(e=this.reporter)||void 0===e||e.track("$page_view",{view_position:window.scrollY+window.innerHeight})}onPageLeave(){var e;null===(e=this.reporter)||void 0===e||e.track("$page_leave",{duration:Date.now()-this.startTime,view_position:window.scrollY+window.innerHeight})}}class l{static getUserAgent(){return navigator.userAgent}static getDevicePixelRatio(){return window.devicePixelRatio||1}static getLanguage(){return navigator.language}static getScreenResolution(){return{width:window.screen.width,height:window.screen.height}}static getViewportSize(){return{width:window.innerWidth||document.documentElement.clientWidth,height:window.innerHeight||document.documentElement.clientHeight}}static getBrowser(){const e=navigator.userAgent;return e.includes("Firefox")?"Firefox":e.includes("Chrome")?"Chrome":e.includes("Safari")?"Safari":e.includes("Opera")?"Opera":e.includes("MSIE")||e.includes("Trident")?"IE":"Unknown"}static getOS(){const e=navigator.userAgent;return e.includes("Windows")?"Windows":e.includes("Macintosh")?"Mac":e.includes("Linux")?"Linux":"Unknown"}static getDeviceType(){const e=navigator.userAgent;return e.includes("Mobile")?"Mobile":e.includes("Tablet")?"Tablet":"Desktop"}static getTimezoneName(){return Intl.DateTimeFormat().resolvedOptions().timeZone}static collectAll(){const e=this.getScreenResolution(),t=this.getViewportSize();return{url:document.URL,path:location.pathname,title:document.title,referrer:document.referrer,dpr:this.getDevicePixelRatio(),user_agent:this.getUserAgent(),language:this.getLanguage(),os:this.getOS(),browser:this.getBrowser(),device_type:this.getDeviceType(),timezone:this.getTimezoneName(),screen_width:e.width,screen_height:e.height,window_width:t.width,window_height:t.height}}}class c{static generateRandomId(e=32){const t="0123456789abcdef";let n="";if(window.crypto&&window.crypto.getRandomValues){const i=new Uint8Array(e);window.crypto.getRandomValues(i);for(let o=0;o<e;o++)n+=t[i[o]%16]}else for(let i=0;i<e;i++)n+=t[Math.floor(16*Math.random())];return n}static setCookie(e,t,n){let i="";if(void 0!==n){const e=new Date;e.setTime(e.getTime()+60*n*1e3),i=`expires=${e.toUTCString()};`}const o="https:"===window.location.protocol?"SameSite=None; Secure":"";document.cookie=`${e}=${t};${i}path=/;${o}`}static getCookie(e){const t=`${e}=`,n=document.cookie.split(";");for(let e=0;e<n.length;e++){let i=n[e];for(;" "===i.charAt(0);)i=i.substring(1);if(0===i.indexOf(t))return i.substring(t.length)}return null}static getAnonymousId(){let e=this.getCookie(this.ANONYMOUS_ID_COOKIE);return e||(e=this.generateRandomId(),this.setCookie(this.ANONYMOUS_ID_COOKIE,e,24*this.ANONYMOUS_ID_EXPIRE_DAYS*60)),e}static getSessionId(){let e=this.getCookie(this.SESSION_ID_COOKIE);return e||(e=this.generateRandomId(),this.setCookie(this.SESSION_ID_COOKIE,e)),e}}Object.defineProperty(c,"ANONYMOUS_ID_COOKIE",{enumerable:!0,configurable:!0,writable:!0,value:"ga_anonymous_id"}),Object.defineProperty(c,"SESSION_ID_COOKIE",{enumerable:!0,configurable:!0,writable:!0,value:"ga_session_id"}),Object.defineProperty(c,"ANONYMOUS_ID_EXPIRE_DAYS",{enumerable:!0,configurable:!0,writable:!0,value:730});class u{constructor(e,t){Object.defineProperty(this,"head",{enumerable:!0,configurable:!0,writable:!0,value:{code:"",lib:"js",lib_version:"0.0.2",time:Date.now(),aaid:c.getAnonymousId(),sid:c.getSessionId()}}),Object.defineProperty(this,"body",{enumerable:!0,configurable:!0,writable:!0,value:{}}),this.head.code=e,this.body=Object.assign(Object.assign({},l.collectAll()),t)}static toJson(e){return{head:Object.assign({},e.head),body:Object.assign({},e.body)}}}class d{constructor(e){Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxLength=e,this.items=[]}enqueue(e){this.items.length>this.maxLength&&this.dequeue(),this.items.push(e)}dequeue(){return this.items.shift()}peek(){return this.items[0]}isEmpty(){return 0===this.items.length}size(){return this.items.length}clear(){this.items=[]}toString(){return this.items.toString()}}class h{constructor(){Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxQueueSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"timer",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"isConsuming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:"/t"}),this.queue=new d(this.maxQueueSize),this.timer=setInterval(()=>{this.consume()},1e3),(new a).init(this)}static getInstance(){return h.instance||(h.instance=new h),h.instance}static setUrl(e){this.getInstance().url=e}track(e,t){if(window.doNotTrack||navigator.doNotTrack)return;const n=new u(e,t);this.queue.enqueue(n)}consume(){if(!this.isConsuming&&!this.queue.isEmpty()){this.isConsuming=!0;try{const e=10,t=[];let n=[];for(;!this.queue.isEmpty();){const i=this.queue.dequeue();i&&(n.push(i),n.length===e&&(t.push(n),n=[]))}n.length>0&&t.push(n),this.processBatches(t)}finally{this.isConsuming=!1}}}processBatches(e){e.forEach((e,t)=>{r.info(`Processing batch ${t+1} with ${e.length} events`);const n=e.map(u.toJson);navigator.sendBeacon(this.url,JSON.stringify(n))})}destroy(){this.timer&&clearInterval(this.timer)}}return h});
