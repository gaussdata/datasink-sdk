!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).GaussData=t()}(this,function(){"use strict";function e(e){const t=history[e];history[e]=function(...i){console.log(`History.${e} called with:`,i);const n=t.apply(this,i),s=new Event(e);return window.dispatchEvent(s),n}}e("pushState"),e("replaceState");class t{constructor(){Object.defineProperty(this,"reporter",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"startTime",{enumerable:!0,configurable:!0,writable:!0,value:Date.now()})}init(e){this.reporter=e,setTimeout(()=>{this.onPageLoad(),setTimeout(()=>{this.onPageView()})}),window.addEventListener("pushState",()=>this.onPageChange()),window.addEventListener("replaceState",()=>this.onPageChange()),window.addEventListener("popstate",()=>this.onPageChange()),document.addEventListener("click",e=>this.onClick(e))}onClick(e){var t;const i=e.target;null===(t=this.reporter)||void 0===t||t.track("$element_click",{element_id:i.id,element_class:i.className,element_content:i.innerText,page_x:e.pageX,page_y:e.pageY})}onPageLoad(){var e;null===(e=this.reporter)||void 0===e||e.track("$page_load",{})}onPageChange(){this.onPageLeave(),setTimeout(()=>{this.onPageView()},16)}onPageView(){var e;this.startTime=Date.now(),null===(e=this.reporter)||void 0===e||e.track("$page_view",{view_position:window.scrollY+window.innerHeight})}onPageLeave(){var e;null===(e=this.reporter)||void 0===e||e.track("$page_leave",{duration:Date.now()-this.startTime,view_position:window.scrollY+window.innerHeight})}}class i{static getUserAgent(){return navigator.userAgent}static getDevicePixelRatio(){return window.devicePixelRatio||1}static getLanguage(){return navigator.language}static getScreenResolution(){return{width:window.screen.width,height:window.screen.height}}static getViewportSize(){return{width:window.innerWidth||document.documentElement.clientWidth,height:window.innerHeight||document.documentElement.clientHeight}}static collectAll(){const e=this.getScreenResolution(),t=this.getViewportSize();return{url:document.URL,path:location.pathname,title:document.title,referrer:document.referrer,dpr:this.getDevicePixelRatio(),user_agent:this.getUserAgent(),language:this.getLanguage(),screen_width:e.width,screen_height:e.height,window_width:t.width,window_height:t.height}}}class n{static generateRandomId(e=32){const t="0123456789abcdef";let i="";if(window.crypto&&window.crypto.getRandomValues){const n=new Uint8Array(e);window.crypto.getRandomValues(n);for(let s=0;s<e;s++)i+=t[n[s]%16]}else for(let n=0;n<e;n++)i+=t[Math.floor(16*Math.random())];return i}static setCookie(e,t,i){let n="";if(void 0!==i){const e=new Date;e.setTime(e.getTime()+60*i*1e3),n=`expires=${e.toUTCString()};`}const s="https:"===window.location.protocol?"SameSite=None; Secure":"";document.cookie=`${e}=${t};${n}path=/;${s}`}static getCookie(e){const t=`${e}=`,i=document.cookie.split(";");for(let e=0;e<i.length;e++){let n=i[e];for(;" "===n.charAt(0);)n=n.substring(1);if(0===n.indexOf(t))return n.substring(t.length)}return null}static getAnonymousId(){let e=this.getCookie(this.ANONYMOUS_ID_COOKIE);return e||(e=this.generateRandomId(),this.setCookie(this.ANONYMOUS_ID_COOKIE,e,24*this.ANONYMOUS_ID_EXPIRE_DAYS*60)),e}static getSessionId(){let e=this.getCookie(this.SESSION_ID_COOKIE);return e||(e=this.generateRandomId(),this.setCookie(this.SESSION_ID_COOKIE,e)),e}}Object.defineProperty(n,"ANONYMOUS_ID_COOKIE",{enumerable:!0,configurable:!0,writable:!0,value:"ga_anonymous_id"}),Object.defineProperty(n,"SESSION_ID_COOKIE",{enumerable:!0,configurable:!0,writable:!0,value:"ga_session_id"}),Object.defineProperty(n,"ANONYMOUS_ID_EXPIRE_DAYS",{enumerable:!0,configurable:!0,writable:!0,value:730});class s{constructor(e,t){Object.defineProperty(this,"head",{enumerable:!0,configurable:!0,writable:!0,value:{code:"",lib:"js",lib_version:"0.0.1",time:Date.now(),aaid:n.getAnonymousId(),sid:n.getSessionId()}}),Object.defineProperty(this,"body",{enumerable:!0,configurable:!0,writable:!0,value:{}}),this.head.code=e,this.body=Object.assign(Object.assign({},i.collectAll()),t)}static toJson(e){return{head:Object.assign({},e.head),body:Object.assign({},e.body)}}}class r{constructor(e){Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxLength=e,this.items=[]}enqueue(e){this.items.length>this.maxLength&&this.dequeue(),this.items.push(e)}dequeue(){return this.items.shift()}peek(){return this.items[0]}isEmpty(){return 0===this.items.length}size(){return this.items.length}clear(){this.items=[]}toString(){return this.items.toString()}}class o{constructor(){Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxQueueSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"timer",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"isConsuming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:"/t"}),this.queue=new r(this.maxQueueSize),this.timer=setInterval(()=>{this.consume()},1e3),(new t).init(this)}static getInstance(){return o.instance||(o.instance=new o),o.instance}static setUrl(e){this.getInstance().url=e}track(e,t){const i=new s(e,t);this.queue.enqueue(i)}consume(){if(!this.isConsuming&&!this.queue.isEmpty()){this.isConsuming=!0;try{const e=10,t=[];let i=[];for(;!this.queue.isEmpty();){const n=this.queue.dequeue();n&&(i.push(n),i.length===e&&(t.push(i),i=[]))}i.length>0&&t.push(i),this.processBatches(t)}finally{this.isConsuming=!1}}}processBatches(e){e.forEach((e,t)=>{console.log(`Processing batch ${t+1} with ${e.length} events`);const i=e.map(s.toJson);navigator.sendBeacon(this.url,JSON.stringify(i))})}destroy(){this.timer&&clearInterval(this.timer)}}return o});
